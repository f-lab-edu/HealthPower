<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<div th:replace="fragments/header :: user-status"></div>
<ul th:if="${productPage != null}">
    <li th:each="product : ${productPage.content}">
        <div>
            <label>ìƒí’ˆëª… : </label>
            <strong th:text="${product.productName}">ìƒí’ˆëª…</strong>
        </div>
        <p th:text="'ë“±ë¡ì¼ì : ' + ${#temporals.format(product.createdAt, 'yyyy-MM-dd HH:mm:ss')}">ë“±ë¡ì¼ì</p>
        <div>
            <label>ì‘ì„±ì : </label>
            <span th:text="${product.userId}">ì‘ì„±ì</span>
        </div>
        <div>
            <a th:href="@{/board/product/{id}(id=${product.id})}">ìƒì„¸ë³´ê¸°</a>
        </div>
    </li>
</ul>

<div>
    <a th:href="@{/board/productCreate}">ìƒí’ˆë“±ë¡</a>
</div>

<button id="claimBtn" data-coupon-id="4">ì„ ì°©ìˆœ ì¿ í° ë°›ê¸°(í•œì • ìˆ˜ëŸ‰ 100ê°œ)</button>
<p id="result"></p>
<div class="pagination">
    <!-- ì²« í˜ì´ì§€ë¡œ ì´ë™ -->
    <a th:if="${!productPage.first}" th:href="@{/board/product(page=0)}">Â« ì²˜ìŒ</a>

    <!-- ì´ì „ í˜ì´ì§€ -->
    <a th:if="${productPage.hasPrevious()}"
       th:href="@{/board/product(page=${productPage.number - 1})}">â€¹ ì´ì „</a>

    <!-- ë²ˆí˜¸ ë¦¬ìŠ¤íŠ¸ -->
    <span th:each="i : ${#numbers.sequence(0, productPage.totalPages - 1)}">
        <a th:href="@{/board/product(page=${i})}"
           th:text="${i + 1}"
           th:classappend="${i == productPage.number} ? 'active-page' : ''">
        </a>
    </span>

    <!-- ë‹¤ìŒ í˜ì´ì§€ -->
    <a th:if="${productPage.hasNext()}"
       th:href="@{/board/product(page=${productPage.number + 1})}">ë‹¤ìŒ â€º</a>

    <!-- ë§ˆì§€ë§‰ í˜ì´ì§€ë¡œ ì´ë™ -->
    <a th:if="${!productPage.last}"
       th:href="@{/board/product(page=${productPage.totalPages - 1})}">ë§ˆì§€ë§‰ Â»</a>
</div>
</body>
<link rel="stylesheet" th:href="@{/css/style.css}">
<script>
    document.getElementById("claimBtn").addEventListener("click", async () => {
      const couponId = document.getElementById("claimBtn").dataset.couponId;

      try {
        const response = await fetch(`/coupons/${couponId}/claim`, {
          method: "POST",
          credentials: "include"
        });

        const result = await response.json();

        if (response.ok) {
          document.getElementById("result").innerText =
            `ğŸ‰ ì¿ í° ë°œê¸‰ ì„±ê³µ! ë‚¨ì€ ìˆ˜ëŸ‰: ${result.left}`;
        } else {
          document.getElementById("result").innerText = `âŒ ì˜¤ë¥˜: ${result.message}`;
        }
      } catch (err) {
        document.getElementById("result").innerText = "âš ï¸ ì„œë²„ ì˜¤ë¥˜ ë°œìƒ";
      }
    });
</script>
</html>
